<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Real-time road sign detection with AI for visually impaired users">
    
    <title>SignVision - Road Sign Detection</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    
    <!-- Preload camera feed for better performance -->
    <link rel="preload" as="video" href="#">
</head>
<body>
    <!-- Main Container -->
    <div id="app">
        
        <!-- Header/Status Bar -->
        <header class="status-bar">
            <div class="status-indicators">
                <span id="connection-status" class="status-indicator">‚óè</span>
                <span id="camera-status" class="status-indicator">üì∑</span>
            </div>
            <h1>SignVision</h1>
            <button id="settings-btn" class="icon-btn" aria-label="Settings">‚öôÔ∏è</button>
        </header>

        <!-- Camera Container -->
        <div class="camera-container">
            <!-- Live Video Stream (iPhone rear camera) -->
            <video id="video" 
                   autoplay 
                   playsinline 
                   muted
                   aria-label="Camera feed">
            </video>
            
            <!-- Detection Overlay Canvas (transparent overlay with bounding boxes) -->
            <canvas id="overlay"></canvas>
            
            <!-- Hidden Canvas for image capture and processing -->
            <canvas id="capture" style="display: none;"></canvas>
            
            <!-- Loading indicator - Hidden -->
            <div id="loading" class="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <p>Processing frame...</p>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <button id="start-btn" class="control-btn primary">
                <span class="icon">‚ñ∂</span>
                <span>Start</span>
            </button>
            
            <button id="pause-btn" class="control-btn secondary" disabled>
                <span class="icon">‚è∏</span>
                <span>Pause</span>
            </button>
            
            <!-- Record button hidden -->
            <button id="record-btn" class="control-btn secondary" style="display: none;">
                <span class="icon">‚óè</span>
                <span id="record-text">Record</span>
            </button>
            
            <button id="audioToggle" class="control-btn secondary" style="background: #f39c12;">
                <span class="icon">üîá</span>
                <span>Enable Audio</span>
            </button>
        </div>

        <!-- Detection Results Panel -->
        <div class="detection-panel" id="detection-panel" style="display: none;">
            <h3>Detected Objects</h3>
            <div id="detection-list"></div>
        </div>

        <!-- Audio Feedback Status -->
        <div class="audio-status">
            <span id="audio-status-text">üîá Audio: Ready</span>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button id="close-settings" class="close-btn">√ó</button>
                </div>
                <div class="modal-body">
                    <label for="voice-toggle">
                        <input type="checkbox" id="voice-toggle" checked>
                        Enable Voice Feedback
                    </label>
                    <label for="sensitivity">
                        Detection Sensitivity
                        <input type="range" id="sensitivity" min="1" max="10" value="5">
                        <span id="sensitivity-value">5</span>
                    </label>
                    <label for="processing-interval">
                        Processing Interval (ms)
                        <input type="number" id="processing-interval" value="1000" min="500" max="5000" step="100">
                    </label>
                    <label for="api-endpoint">
                        API Endpoint
                        <input type="text" id="api-endpoint" value="http://localhost:8000/analyze" placeholder="Change to ngrok URL when using remote access">
                    </label>
                </div>
            </div>
        </div>

        <!-- Error Toast -->
        <div id="error-toast" class="toast hidden">
            <span id="error-message"></span>
        </div>
    </div>

    <!-- TensorFlow.js + COCO-SSD for Fast Detection -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
    
    <!-- Note: Using COCO-SSD as fast YOLO alternative (pre-trained, ready to use) -->
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('SW registered:', reg))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }
    </script>

    <!-- Main Application Logic -->
    <script src="script.js"></script>
</body>
</html>

